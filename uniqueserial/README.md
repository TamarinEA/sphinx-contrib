# Uniqueserial UDF

Внимание: uniqueserial UDF работает только с целочисленными атрибутами.

Uniqueserial возвращает номер строки в скоупе (партиции) некоторого атрибута.
Внутри функция инициализирует map вида атрибут -> кол-во, и во время запроса для каждого атрибута увеличивает кол-во,
в зависимости от того, сколько раз он встретился в выборке. В результате получаем номер строки для каждого docid.

Примеры:

```sql
SELECT uniqueserial(company_id) AS pos, sorted_name, company_id FROM product WHERE company_id IN (13497, 12229) ORDER BY company_id ASC, pos ASC;

+---------+------------------------------------------------------------------------------------------------------------------------------------------+------------+
|     pos | company_id | sorted_name                                                                                                                              |
+---------+------------------------------------------------------------------------------------------------------------------------------------------+------------+
|       1 |      12229 | ремонтная смесь мбр400 машинного нанесения, 25кг                                                                                         |
|       2 |      12229 | ремонтный состав для бетона мбр-500 гора хрустальная, 25 кг                                                                              |
|       3 |      12229 | смесь ремонтная для бетона гора хрустальная мбр 300 литьевой тип 25кг                                                                    |
|       1 |      13497 | стул для кафе герцог №2                                                                                                                  |
|       2 |      13497 | стул для столовой №1ш                                                                                                                    |
|       3 |      13497 | вешало напольное № 3ш гардеробное                                                                                                        |

SELECT uniqueserial(company_id) AS pos, company_id, sorted_name FROM product WHERE company_id IN (8665095, 8668666) ORDER BY pos ASC LIMIT 100;
+------+------------+------------------------------------------------------------------------------------------------+
| pos  | company_id | sorted_name                                                                                    |
+------+------------+------------------------------------------------------------------------------------------------+
|    1 |    8665095 | занятие на прессотерапии (лимфоштаны + лимфокуртка)                                            |
|    1 |    8668666 | камин                                                                                          |
|    2 |    8665095 | занятия на тонусном столе                                                                      |
|    2 |    8668666 | скульптура                                                                                     |
|    3 |    8665095 | занятие на баланс-платформе для суставов                                                       |
|    3 |    8668666 | изготовление мемориаллов                                                                       |
|    4 |    8665095 | занятия на роликовом тренажере                                                                 |
|    4 |    8668666 | изготовление мемориаллов под заказ                                                             |
|    5 |    8665095 | занятия на вибротренажере (виброплатформе)                                                     |
|    5 |    8668666 | скульптура                                                                                     |
|    6 |    8668666 | изготовление мемориаллов под заказ                                                             |
|    6 |    8665095 | массажный пояс                                                                                 |
+------+------------+------------------------------------------------------------------------------------------------+
12 rows in set (0.01 sec)
```
